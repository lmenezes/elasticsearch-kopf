// isDefined tests
test("cluster creating", function() {
    var state = JSON.parse('{"cluster_name":"elasticsearch","master_node":"JeJZMVwyTIG9bb674DJnoA","blocks":{"indices":{"qux":{"4":{"description":"index closed","retryable":false,"levels":["read","write"]}}}},"nodes":{"JeJZMVwyTIG9bb674DJnoA":{"name":"Garrison Kane","transport_address":"inet[/192.168.1.111:9300]","attributes":{}},"ZlHH_Wr8TXyA1BvWL7VSXQ":{"name":"Machine Teen","transport_address":"inet[/192.168.1.111:9301]","attributes":{}}},"routing_table":{"indices":{"foobar":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"ZlHH_Wr8TXyA1BvWL7VSXQ","relocating_node":null,"shard":0,"index":"foobar"}],"1":[{"state":"STARTED","primary":true,"node":"JeJZMVwyTIG9bb674DJnoA","relocating_node":null,"shard":1,"index":"foobar"}]}},"foobaz":{"shards":{"0":[{"state":"STARTED","primary":true,"node":"ZlHH_Wr8TXyA1BvWL7VSXQ","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"STARTED","primary":false,"node":"JeJZMVwyTIG9bb674DJnoA","relocating_node":null,"shard":0,"index":"foobaz"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"foobaz"}],"nodes":{"ZlHH_Wr8TXyA1BvWL7VSXQ":[{"state":"STARTED","primary":true,"node":"ZlHH_Wr8TXyA1BvWL7VSXQ","relocating_node":null,"shard":0,"index":"foobar"},{"state":"STARTED","primary":true,"node":"ZlHH_Wr8TXyA1BvWL7VSXQ","relocating_node":null,"shard":0,"index":"foobaz"}],"JeJZMVwyTIG9bb674DJnoA":[{"state":"STARTED","primary":true,"node":"JeJZMVwyTIG9bb674DJnoA","relocating_node":null,"shard":1,"index":"foobar"},{"state":"STARTED","primary":false,"node":"JeJZMVwyTIG9bb674DJnoA","relocating_node":null,"shard":0,"index":"foobaz"}]}},"allocations":[]}');
    var status = JSON.parse('{"_shards":{"total":5,"successful":4,"failed":0},"indices":{"foobar":{"index":{"primary_size_in_bytes":6850,"size_in_bytes":6850},"translog":{"operations":8},"docs":{"num_docs":8,"max_doc":8,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":27},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"ZlHH_Wr8TXyA1BvWL7VSXQ","relocating_node":null,"shard":0,"index":"foobar"},"state":"STARTED","index":{"size_in_bytes":3425},"translog":{"id":1408476760759,"operations":4},"docs":{"num_docs":4,"max_doc":4,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":14},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JeJZMVwyTIG9bb674DJnoA","relocating_node":null,"shard":1,"index":"foobar"},"state":"STARTED","index":{"size_in_bytes":3425},"translog":{"id":1408476760792,"operations":4},"docs":{"num_docs":4,"max_doc":4,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":13},"flush":{"total":0,"total_time_in_millis":0}}]}},"foobaz":{"index":{"primary_size_in_bytes":115,"size_in_bytes":194},"translog":{"operations":0},"docs":{"num_docs":0,"max_doc":0,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":0},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"ZlHH_Wr8TXyA1BvWL7VSXQ","relocating_node":null,"shard":0,"index":"foobaz"},"state":"STARTED","index":{"size_in_bytes":115},"translog":{"id":1408476760899,"operations":0},"docs":{"num_docs":0,"max_doc":0,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":0},"flush":{"total":0,"total_time_in_millis":0}},{"routing":{"state":"STARTED","primary":false,"node":"JeJZMVwyTIG9bb674DJnoA","relocating_node":null,"shard":0,"index":"foobaz"},"state":"STARTED","index":{"size_in_bytes":79},"translog":{"id":1408476760899,"operations":0},"docs":{"num_docs":0,"max_doc":0,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":1,"total_time_in_millis":0},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
    var stats = JSON.parse('{"cluster_name":"elasticsearch","nodes":{"ZlHH_Wr8TXyA1BvWL7VSXQ":{"timestamp":1408476762287,"name":"Machine Teen","transport_address":"inet[/192.168.1.111:9301]","host":"nb-lmenezes-2.local","ip":["inet[/192.168.1.111:9301]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3540,"throttle_time_in_millis":0},"indexing":{"index_total":4,"index_time_in_millis":6,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":7,"total_time_in_millis":14},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":0},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8744,"index_writer_memory_in_bytes":0,"version_map_memory_in_bytes":0},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0}},"os":{"timestamp":1408476762293,"uptime_in_millis":207454,"load_average":[1.47509765625,2.23095703125,2.1923828125],"cpu":{"sys":1,"user":3,"idle":94,"usage":4,"stolen":0},"mem":{"free_in_bytes":17039360,"used_in_bytes":8572895232,"free_percent":29,"used_percent":70,"actual_free_in_bytes":2547826688,"actual_used_in_bytes":6042107904},"swap":{"used_in_bytes":468189184,"free_in_bytes":605552640}},"process":{"timestamp":1408476762293,"open_file_descriptors":264,"cpu":{"percent":2,"sys_in_millis":1006,"user_in_millis":6416,"total_in_millis":7422},"mem":{"resident_in_bytes":214982656,"share_in_bytes":-1,"total_virtual_in_bytes":3938074624}},"jvm":{"timestamp":1408476762293,"uptime_in_millis":175367,"mem":{"heap_used_in_bytes":31855608,"heap_used_percent":3,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":36473192,"non_heap_committed_in_bytes":37683200,"pools":{"young":{"used_in_bytes":6874792,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":7718424,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":17262392,"max_in_bytes":715849728,"peak_used_in_bytes":17262392,"peak_max_in_bytes":715849728}}},"threads":{"count":80,"peak_count":80},"gc":{"collectors":{"young":{"collection_count":4,"collection_time_in_millis":55},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":72,"used_in_bytes":13108757,"total_capacity_in_bytes":13108757},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":3,"queue":0,"active":0,"rejected":0,"largest":3,"completed":75},"index":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":4,"completed":4},"snapshot_data":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":3,"queue":0,"active":0,"rejected":0,"largest":3,"completed":9},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":1},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":2,"queue":0,"active":1,"rejected":0,"largest":2,"completed":2},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":2}},"network":{"tcp":{"active_opens":70061,"passive_opens":6002,"curr_estab":129,"in_segs":91455455,"out_segs":89031951,"retrans_segs":5143,"estab_resets":3445,"attempt_fails":31450,"in_errs":614,"out_rsts":-1}},"fs":{"timestamp":1408476762294,"total":{"total_in_bytes":249804886016,"free_in_bytes":94897012736,"available_in_bytes":94634868736,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.3.1/data/elasticsearch/nodes/1","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":94897012736,"available_in_bytes":94634868736,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":458,"rx_size_in_bytes":97684,"tx_count":457,"tx_size_in_bytes":28876},"http":{"current_open":0,"total_opened":0},"fielddata_breaker":{"maximum_size_in_bytes":622775500,"maximum_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0}},"JeJZMVwyTIG9bb674DJnoA":{"timestamp":1408476762286,"name":"Garrison Kane","transport_address":"inet[/192.168.1.111:9300]","host":"nb-lmenezes-2.local","ip":["inet[/192.168.1.111:9300]","NONE"],"indices":{"docs":{"count":4,"deleted":0},"store":{"size_in_bytes":3504,"throttle_time_in_millis":0},"indexing":{"index_total":12,"index_time_in_millis":11,"index_current":0,"delete_total":0,"delete_time_in_millis":0,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":14,"total_time_in_millis":45},"flush":{"total":0,"total_time_in_millis":0},"warmer":{"current":0,"total":6,"total_time_in_millis":0},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":-1,"memory_size":"-1b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":1,"memory_in_bytes":8744,"index_writer_memory_in_bytes":0,"version_map_memory_in_bytes":0},"translog":{"operations":4,"size_in_bytes":0},"suggest":{"total":0,"time_in_millis":0,"current":0}},"os":{"timestamp":1408476762287,"uptime_in_millis":207454,"load_average":[1.47509765625,2.23095703125,2.1923828125],"cpu":{"sys":2,"user":5,"idle":92,"usage":7,"stolen":0},"mem":{"free_in_bytes":17031168,"used_in_bytes":8572903424,"free_percent":29,"used_percent":70,"actual_free_in_bytes":2547830784,"actual_used_in_bytes":6042103808},"swap":{"used_in_bytes":468189184,"free_in_bytes":605552640}},"process":{"timestamp":1408476762287,"open_file_descriptors":265,"cpu":{"percent":1,"sys_in_millis":2375,"user_in_millis":10661,"total_in_millis":13036},"mem":{"resident_in_bytes":238399488,"share_in_bytes":-1,"total_virtual_in_bytes":3947216896}},"jvm":{"timestamp":1408476762287,"uptime_in_millis":427127,"mem":{"heap_used_in_bytes":93706560,"heap_used_percent":9,"heap_committed_in_bytes":259522560,"heap_max_in_bytes":1037959168,"non_heap_used_in_bytes":38293640,"non_heap_committed_in_bytes":39059456,"pools":{"young":{"used_in_bytes":62964680,"max_in_bytes":286326784,"peak_used_in_bytes":71630848,"peak_max_in_bytes":286326784},"survivor":{"used_in_bytes":5419376,"max_in_bytes":35782656,"peak_used_in_bytes":8912896,"peak_max_in_bytes":35782656},"old":{"used_in_bytes":25322504,"max_in_bytes":715849728,"peak_used_in_bytes":25322504,"peak_max_in_bytes":715849728}}},"threads":{"count":84,"peak_count":87},"gc":{"collectors":{"young":{"collection_count":5,"collection_time_in_millis":67},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":96,"used_in_bytes":21518082,"total_capacity_in_bytes":21518082},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":3,"queue":0,"active":0,"rejected":0,"largest":4,"completed":172},"index":{"threads":8,"queue":0,"active":0,"rejected":0,"largest":8,"completed":12},"snapshot_data":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bench":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":2,"completed":6},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":19},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":3,"queue":0,"active":1,"rejected":0,"largest":3,"completed":33},"refresh":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":5}},"network":{"tcp":{"active_opens":70061,"passive_opens":6002,"curr_estab":129,"in_segs":91455455,"out_segs":89031951,"retrans_segs":5143,"estab_resets":3445,"attempt_fails":31450,"in_errs":614,"out_rsts":-1}},"fs":{"timestamp":1408476762288,"total":{"total_in_bytes":249804886016,"free_in_bytes":94897012736,"available_in_bytes":94634868736,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0},"data":[{"path":"/Users/leonardo.menezes/Downloads/elasticsearch-1.3.1/data/elasticsearch/nodes/0","mount":"/","dev":"/dev/disk1","total_in_bytes":249804886016,"free_in_bytes":94897012736,"available_in_bytes":94634868736,"disk_reads":0,"disk_writes":0,"disk_io_op":0,"disk_read_size_in_bytes":0,"disk_write_size_in_bytes":0,"disk_io_size_in_bytes":0}]},"transport":{"server_open":26,"rx_count":457,"rx_size_in_bytes":28876,"tx_count":458,"tx_size_in_bytes":97684},"http":{"current_open":1,"total_opened":49},"fielddata_breaker":{"maximum_size_in_bytes":622775500,"maximum_size":"593.9mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03,"tripped":0}}}}');
    var settings = JSON.parse('{"foobaz":{"settings":{"index":{"uuid":"I8H15lJAQDudPNETIAyq_w","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_replicas":"2","number_of_shards":"1","version":{"created":"1030199"}}}},"foobar":{"settings":{"index":{"uuid":"RB34fXxNQB6B9NUZS3G18g","analysis":{"analyzer":{"index_inc_search":{"filter":["lowercase"],"tokenizer":"whitespace"}}},"number_of_replicas":"0","number_of_shards":"2","version":{"created":"1030199"}}}}}');
    var aliases = JSON.parse('{"foobaz":{"aliases":{}},"foobar":{"aliases":{}},"qux":{"aliases":{}}}');
	var cluster = new Cluster(state, status, stats, settings, aliases);

	var size_pattern = /\d+\.\d+\w{1,2}/;
	var number_pattern = /\d+/;

	// check clustercluster properties
	equal(cluster.num_docs, 8, "Number of documents");
	//equal(cluster.total_size == '16.49KB', "Checking total size");
	equal(cluster.unassigned_shards, 1, "Unassigned shards");
	equal(cluster.shards, 5, "Number of shards");
	equal(cluster.failed_shards, 0, "Failed shards");
	equal(cluster.total_indices, 3, "Number of indices");
	var master_node = cluster.master_node;

	// index info
	ok(cluster.indices.length, 3, "Indices list length");

	var indices = cluster.indices;
	indices.forEach(function(index) {
		ok(index.state == 'open' || index.state == 'close', "Checking index state: [" + index.state + "]");
		ok(number_pattern.test(index.size), "Checking primary size: [" + index.size + "]");
		ok(number_pattern.test(index.total_size), "Checking total size: [" + index.total_size + "]");
		if (index.state == 'open') {
			ok(size_pattern.test(index.size_in_bytes), "Checking primary size: [" + index.size_in_bytes + "]");
			ok(size_pattern.test(index.total_size_in_bytes), "Checking total size: [" + index.total_size_in_bytes + "]");
		}
		ok(number_pattern.test(index.num_docs), "Checking num docs: [" + index.num_docs + "]");
		ok(number_pattern.test(index.max_doc), "Checking max doc: [" + index.max_doc + "]");
		ok(number_pattern.test(index.deleted_docs), "Checking deleted docs: [" + index.deleted_docs + "]");
		ok(index.name.length > 0, "Checking index name: [" + index.name + "]");
		ok(number_pattern.test(index.num_of_shards), "Checking number of shards: [" + index.num_of_shards + "]");
		ok(number_pattern.test(index.num_of_replicas), "Checking number of replicas: [" + index.num_of_replicas + "]");
		var node_ids = cluster.nodes.map(function(node) { return node.id; });
		node_ids.forEach(function(node_id) {
			if (index.getShards(node_id) != null) {
				index.getShards(node_id).forEach(function(shard) {
					ok(shard.primary == true || shard.primary == false, "Checking primary status: [" + shard.primary +"]");
					equal(shard.node, node_id, "Shards should have referece to correct node");
					ok(shard.state == 'STARTED', "Shards should be started: [" + shard.state + "]");
				});
			}
		});

	});

	// check nodes
	var nodes = cluster.nodes;
	equal(nodes.length, 2, "Unfiltered node list");
	var master_nodes = 0;
	nodes.forEach(function(node) {
		ok(size_pattern.test(node.disk_total), "Checking disk total [" + node.disk_total + "]");
		ok(size_pattern.test(node.disk_free), "Checking free disk [" + node.disk_total + "]");
		ok(node.disk_used_percent >= 0 && node.disk_used_percent <= 100, "Checking disk usage in percent [" + node.disk_used_percent + "]");
		ok(size_pattern.test(node.size), "Checking node sotre size [" + node.size + "]");
		ok(size_pattern.test(node.heap_used), "Checking node heap used [" + node.heap_used + "]");
		ok(size_pattern.test(node.heap_committed), "Checking node heap commited [" + node.heap_committed + "]");
		ok(size_pattern.test(node.heap_max), "Checking max heap size [" + node.heap_max + "]");
		ok(node.heap_used_percent >= 0 && node.heap_used_percent <= 100, "Checking heap used percent [" + node.heap_used_percent + "]");
		ok(node.cpu_user >= 0 && number_pattern.test(node.cpu_user), "Checking os user cpu [" + node.cpu_user + "]");
		ok(node.cpu_sys >= 0 && number_pattern.test(node.cpu_sys), "Checking os sys cpu [" + node.cpu_sys + "]");
		equal(node.id.length, 22, "Checking node id length");
		ok(number_pattern.test(node.docs), "Checking number of documents per node " + node.docs);
		if (node.current_master) {
			master_nodes += 1;
			equal(master_node, node.id, "Checking current master");
		}
	});
	equal(master_nodes, 1, "There should be exactly one master node");
});

test("computing cluster changes", function() {
	var state = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tne-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tne-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
	var status = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":16887,"size_in_bytes":16887},"translog":{"operations":8},"docs":{"num_docs":6,"max_doc":6,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
	var stats = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":16887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
	var settings = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
    var aliases = JSON.parse('{"foobaz":{"aliases":{}},"foobar":{"aliases":{}},"qux":{"aliases":{}}}');
	var cluster = new Cluster(state, status, stats, settings, aliases);

	var state2 = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tn-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tn-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tn-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
	var status2 = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":19887,"size_in_bytes":19887},"translog":{"operations":8},"docs":{"num_docs":7,"max_doc":7,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
	var stats2 = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tn-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":19887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
	var settings2 = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
	var cluster2 = new Cluster(state2, status2, stats2, settings2, aliases);

	cluster2.computeChanges(cluster);
	
	ok(cluster2.changes.getDocDelta() == 1, "Checking document delta");
	ok(cluster2.changes.getDataDelta() == 3000, "" + cluster2.changes.getDataDelta());
	ok(cluster2.changes.absDataDelta() == "2.93KB", "" + cluster2.changes.absDataDelta());

	ok(cluster2.changes.nodeJoins.length == 1, "checking joinng nodes");
	ok(cluster2.changes.nodeLeaves.length == 1, "checking disconnecting nodes");
	
	ok(cluster2.changes.nodeJoins[0].id == "JvYCtd57Tn-fxlK1GVHRw", "checking node identity");
	ok(cluster2.changes.nodeLeaves[0].id == "JvYCtd57Tne-fxlK1GVHRw", "checking node identity");
});

test("computing cluster changes on two different clusters should yield no changes", function() {
    var state = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tne-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tne-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
    var status = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":16887,"size_in_bytes":16887},"translog":{"operations":8},"docs":{"num_docs":6,"max_doc":6,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
    var stats = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":16887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
    var settings = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
    var aliases = JSON.parse('{"foobaz":{"aliases":{}},"foobar":{"aliases":{}},"qux":{"aliases":{}}}');
    var cluster = new Cluster(state, status, stats, settings, aliases);

    var state2 = JSON.parse('{"cluster_name":"kopf_cluster2","master_node":"JvYCtd57Tn-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tn-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tn-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
    var status2 = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":19887,"size_in_bytes":19887},"translog":{"operations":8},"docs":{"num_docs":7,"max_doc":7,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
    var stats2 = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tn-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":7,"deleted":0},"store":{"size_in_bytes":19887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
    var settings2 = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
    var cluster2 = new Cluster(state2, status2, stats2, settings2, aliases);

    cluster2.computeChanges(cluster);
    ok(cluster2.changes.hasChanges() == false, "No changes");
});

// isDefined tests
test("cluster creating", function() {
	// 1.0.0 BASED
	var state = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tne-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tne-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
	var status = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":16887,"size_in_bytes":16887},"translog":{"operations":8},"docs":{"num_docs":6,"max_doc":6,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
	var stats = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":16887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
	var settings = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
	var cluster = new Cluster(state, status, stats, settings);

	// 0.90.0 BASED
	var state_90 = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tne-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index.analysis.analyzer.kopf_analyzer_1.tokenizer":"whitespace","index.analysis.analyzer.kopf_analyzer_1.type":"custom","index.analysis.analyzer.kopf_analyzer_2.type":"custom","index.version.created":"1000051","index.number_of_replicas":"1","index.uuid":"7yDVKjHeS7uKbQuQbs3VNw","index.number_of_shards":"5","index.analysis.analyzer.kopf_analyzer_2.tokenizer":"whitespace"},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"multi_field","fields":{"content_2":{"include_in_all":false,"type":"string"},"content_2_raw":{"include_in_all":false,"type":"string"}}},"content_1":{"path":"just_name","type":"multi_field","fields":{"content_1":{"type":"string"},"content_1_raw":{"include_in_all":false,"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"nodes":{"JvYCtd57Tne-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"}]}},"allocations":[]}');
	var status_90 = JSON.parse('{"ok":true,"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size":"16.9kb","primary_size_in_bytes":16887,"size":"16.9kb","size_in_bytes":16887},"translog":{"operations":8},"docs":{"num_docs":6,"max_doc":6,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":5,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size":"2.8kb","size_in_bytes":2831},"translog":{"id":1390857853128,"operations":0},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":1,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size":"2.8kb","size_in_bytes":2831},"translog":{"id":1390857853156,"operations":0},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":1,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size":"5.5kb","size_in_bytes":5721},"translog":{"id":1390857853171,"operations":0},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":1,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size":"2.8kb","size_in_bytes":2909},"translog":{"id":1390857853143,"operations":0},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":1,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size":"2.8kb","size_in_bytes":2909},"translog":{"id":1390857853205,"operations":0},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":1,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0}}]}}}}');
	var stats_90 = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"timestamp":1390928019968,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","hostname":"leo.local","indices":{"docs":{"count":6,"deleted":0},"store":{"size":"16.9kb","size_in_bytes":16887,"throttle_time":"0s","throttle_time_in_millis":0},"indexing":{"index_total":0,"index_time":"0s","index_time_in_millis":0,"index_current":0,"delete_total":0,"delete_time":"0s","delete_time_in_millis":0,"delete_current":0},"get":{"total":0,"get_time":"0s","time_in_millis":0,"exists_total":0,"exists_time":"0s","exists_time_in_millis":0,"missing_total":0,"missing_time":"0s","missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":0,"query_time":"0s","query_time_in_millis":0,"query_current":0,"fetch_total":0,"fetch_time":"0s","fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size":"0b","current_size_in_bytes":0,"total":0,"total_time":"0s","total_time_in_millis":0,"total_docs":0,"total_size":"0b","total_size_in_bytes":0},"refresh":{"total":5,"total_time":"0s","total_time_in_millis":0},"flush":{"total":0,"total_time":"0s","total_time_in_millis":0},"warmer":{"current":0,"total":5,"total_time":"58ms","total_time_in_millis":58},"filter_cache":{"memory_size":"0b","memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size":"0b","memory_size_in_bytes":0},"fielddata":{"memory_size":"0b","memory_size_in_bytes":0,"evictions":0},"completion":{"size":"0b","size_in_bytes":0},"segments":{"count":6,"memory":"0b","memory_in_bytes":0}},"os":{"timestamp":1390928019969,"uptime":"12.7m","uptime_in_millis":763467,"load_average":[5.7880859375,30.56884765625,23.6787109375],"cpu":{"sys":11,"user":18,"idle":78,"usage":20,"stolen":0},"mem":{"free":"579.8mb","free_in_bytes":608063488,"used":"7.4gb","used_in_bytes":7981871104,"free_percent":36,"used_percent":63,"actual_free":"2.9gb","actual_free_in_bytes":3153018880,"actual_used":"5gb","actual_used_in_bytes":5436915712},"swap":{"used":"0b","used_in_bytes":0,"free":"1gb","free_in_bytes":1073741824}},"process":{"timestamp":1390928019969,"open_file_descriptors":148,"cpu":{"percent":0,"sys":"645ms","sys_in_millis":645,"user":"5.8s","user_in_millis":5804,"total":"6.4s","total_in_millis":6449},"mem":{"resident":"215.7mb","resident_in_bytes":226185216,"share":"-1b","share_in_bytes":-1,"total_virtual":"3.5gb","total_virtual_in_bytes":3832135680}},"jvm":{"timestamp":1390928019969,"uptime":"36.6s","uptime_in_millis":36681,"mem":{"heap_used":"104.5mb","heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed":"239.3mb","heap_committed_in_bytes":251002880,"heap_max":"1007.3mb","heap_max_in_bytes":1056309248,"non_heap_used":"30.1mb","non_heap_used_in_bytes":31588520,"non_heap_committed":"31.6mb","non_heap_committed_in_bytes":33161216,"pools":{"Code Cache":{"used":"1016.4kb","used_in_bytes":1040832,"max":"48mb","max_in_bytes":50331648,"peak_used":"1mb","peak_used_in_bytes":1061376,"peak_max":"48mb","peak_max_in_bytes":50331648},"Par Eden Space":{"used":"84mb","used_in_bytes":88143432,"max":"133.1mb","max_in_bytes":139591680,"peak_used":"133.1mb","peak_used_in_bytes":139591680,"peak_max":"133.1mb","peak_max_in_bytes":139591680},"Par Survivor Space":{"used":"16.6mb","used_in_bytes":17432568,"max":"16.6mb","max_in_bytes":17432576,"peak_used":"16.6mb","peak_used_in_bytes":17432568,"peak_max":"16.6mb","peak_max_in_bytes":17432576},"CMS Old Gen":{"used":"3.8mb","used_in_bytes":4040200,"max":"857.6mb","max_in_bytes":899284992,"peak_used":"3.8mb","peak_used_in_bytes":4040200,"peak_max":"857.6mb","peak_max_in_bytes":899284992},"CMS Perm Gen":{"used":"29.1mb","used_in_bytes":30547688,"max":"82mb","max_in_bytes":85983232,"peak_used":"29.1mb","peak_used_in_bytes":30547688,"peak_max":"82mb","peak_max_in_bytes":85983232}}},"threads":{"count":38,"peak_count":38},"gc":{"collection_count":1,"collection_time":"59ms","collection_time_in_millis":59,"collectors":{"ParNew":{"collection_count":1,"collection_time":"59ms","collection_time_in_millis":59},"ConcurrentMarkSweep":{"collection_count":0,"collection_time":"0s","collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":25,"used":"3.4mb","used_in_bytes":3666966,"total_capacity":"3.4mb","total_capacity_in_bytes":3666966},"mapped":{"count":0,"used":"0b","used_in_bytes":0,"total_capacity":"0b","total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":5,"queue":0,"active":0,"rejected":0,"largest":5,"completed":35},"index":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"merge":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":5},"flush":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"search":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":1,"rejected":0,"largest":5,"completed":19},"refresh":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0}},"network":{"tcp":{"active_opens":27355,"passive_opens":1514,"curr_estab":53,"in_segs":1841779,"out_segs":1588047,"retrans_segs":2344,"estab_resets":1470,"attempt_fails":4266,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390928019971,"total":{"total":"237.6gb","total_in_bytes":255200755712,"free":"76.7gb","free_in_bytes":82445713408,"available":"76.5gb","available_in_bytes":82158694400,"disk_reads":588547,"disk_writes":878132,"disk_io_op":1466679,"disk_read_size":"8.9gb","disk_read_size_in_bytes":9578772480,"disk_write_size":"14.4gb","disk_write_size_in_bytes":15483418624,"disk_io_size":"23.3gb","disk_io_size_in_bytes":25062191104},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total":"237.6gb","total_in_bytes":255200755712,"free":"76.7gb","free_in_bytes":82445713408,"available":"76.5gb","available_in_bytes":82158694400,"disk_reads":588547,"disk_writes":878132,"disk_io_op":1466679,"disk_read_size":"8.9gb","disk_read_size_in_bytes":9578772480,"disk_write_size":"14.4gb","disk_write_size_in_bytes":15483418624,"disk_io_size":"23.3gb","disk_io_size_in_bytes":25062191104}]},"transport":{"server_open":13,"rx_count":0,"rx_size":"0b","rx_size_in_bytes":0,"tx_count":0,"tx_size":"0b","tx_size_in_bytes":0},"http":{"current_open":6,"total_opened":6}}}}');
	var settings_90 = JSON.parse('{"persistent":{},"transient":{}}');
	var cluster_90 = new Cluster(state_90, status_90, stats_90, settings_90);
	
	var clusters = [];
	clusters.push(cluster);
	clusters.push(cluster_90);
	clusters.forEach(function(current_cluster) {
		// check current_clustercluster properties
		ok(current_cluster.num_docs == 6, "Checking num docs");
		ok(current_cluster.total_size == '16.49KB', "Checking total size");
		ok(current_cluster.unassigned_shards == 5, "Checking unassigned shards");
		ok(current_cluster.shards == 10, "Checking total shards");
		ok(current_cluster.failed_shards == 0, "Checking failed shards");
		ok(current_cluster.total_indices == 1, "Checking number of indices");
		ok(current_cluster.master_node == 'JvYCtd57Tne-fxlK1GVHRw', "Checking master node");
	
		// index info
		ok(current_cluster.indices.length == 1, "Checking indices list");
		var kopf_index = current_cluster.indices[0];
		ok(kopf_index.name == 'kopf_test', "Checking index name");
		ok(kopf_index.num_of_shards == 5, "Checking number of shards");
		ok(kopf_index.num_of_replicas == 1, "Checking number of replicas");
		ok(kopf_index.state == 'open', "Checking index state");
		ok(kopf_index.size == 16887, "Checking primary size");
		ok(kopf_index.total_size == 16887, "Checking total size");
		ok(kopf_index.size_in_bytes == '16.49KB', "Checking primary size");
		ok(kopf_index.total_size_in_bytes == '16.49KB', "Checking total size");
		ok(kopf_index.num_docs == 6, "Checking num docs");
		ok(kopf_index.max_doc == 6, "Checking max doc");
		ok(kopf_index.deleted_docs == 0, "Checking deleted docs");
		
		// shards
		ok(Object.keys(kopf_index.shards).length == 1, "There is only one node with shards");
		ok(Object.keys(kopf_index.shards)[0] == "JvYCtd57Tne-fxlK1GVHRw", "Should be in the node");
		ok(kopf_index.shards["JvYCtd57Tne-fxlK1GVHRw"].length == 5, "There should be 5 active shards for index");
		ok(kopf_index.unassigned.length == 5, "There should be 5 unassigned  shards for index");

		kopf_index.shards["JvYCtd57Tne-fxlK1GVHRw"].forEach(function(shard) {
			ok(shard.primary === true, "Shards should be marked as primary");
			ok(shard.state == 'STARTED', "Shards should be started");
			ok(shard.node == 'JvYCtd57Tne-fxlK1GVHRw', "Shards should have referece to correct node");
		});
				
		// check aliases
		ok(kopf_index.getTypes().length == 1, "Checking types length");
		ok(kopf_index.getTypes()[0] == 'kopf', "Checking type name");
		ok(kopf_index.getFields('kopf').length == 4, "Checking fields length");
		ok(kopf_index.getFields('kopf')[0] == 'content_1', "Checking 1st field");
		ok(kopf_index.getFields('kopf')[1] == 'content_1_raw', "Checking 2nd multi field just name");	
		ok(kopf_index.getFields('kopf')[2] == 'content_2', "Checking 3nd field");
		ok(kopf_index.getFields('kopf')[3] == 'content_2.content_2_raw', "Checking 4th multi field full path");	
	
		// check analyzers
		ok(kopf_index.getAnalyzers().length == 2, "Checking analyzers length");
		ok(kopf_index.getAnalyzers()[0] == 'kopf_analyzer_1', "Checking 1st analyzer");
		ok(kopf_index.getAnalyzers()[1] == 'kopf_analyzer_2', "Checking 2nd analyzer");
	
		// check nodes
		ok(current_cluster.getNodes('', true, true, true).length == 1, "Checking nodes length");
		ok(current_cluster.getNodes('', false, false, false).length == 0, "Checking nodes length");
		ok(current_cluster.getNodes('lack Drago', true, true, true).length == 1, "Checking nodes length");
		ok(current_cluster.getNodes('xxxxxxxxx', true, true, true).length == 0, "Checking nodes length");
		var node = current_cluster.getNodes('', true, true, true)[0];
		ok(node.name == 'Black Dragon', "Checking node name");	
		ok(node.id == 'JvYCtd57Tne-fxlK1GVHRw', "Checking node name");	
		ok(node.heap_used == '97.33MB', "Checking node heap used " + node.heap_used);	
		ok(node.heap_committed == '239.38MB', "Checking node heap commited " + node.heap_committed);	
		ok(node.transport_address == 'inet[/192.168.2.104:9300]', "Checking node transport address");	
		ok(node.current_master, "Checking node is current master");
		
		ok(node.heap_used_percent == '9', "Checking heap used percent " + node.heap_used_percent);	
		ok(node.cpu_user == '18', "Checking os user cpu " + node.cpu_user);
		ok(node.cpu_sys == '11', "Checking os sys cpu " + node.cpu_sys);
		ok(node.docs == '6', "Checking number of documents per node " + node.docs);	
		ok(node.size == '16.49KB', "Checking node sotre size " + node.size);
		ok(node.heap_max == '1007.38MB', "Checking max heap size " + node.heap_max);

		ok(node.fs_used_percent == '68', "Checking fs used percent " + node.fs_used_percent);
		ok(node.fs_total == '237.67GB', "Checking fs total bytes " + node.fs_total);
		ok(node.fs_free == '76.78GB', "Checking fs free bytes " + node.fs_free);
		ok(node.fs_used == '160.89GB', "Checking fs used bytes " + node.fs_used);
	});

});

test("computing cluster changes", function() {
	var state = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tne-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tne-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
	var status = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":16887,"size_in_bytes":16887},"translog":{"operations":8},"docs":{"num_docs":6,"max_doc":6,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tne-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
	var stats = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tne-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":16887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
	var settings = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
	var cluster = new Cluster(state, status, stats, settings);

	var state2 = JSON.parse('{"cluster_name":"kopf_cluster","master_node":"JvYCtd57Tn-fxlK1GVHRw","blocks":{},"nodes":{"JvYCtd57Tn-fxlK1GVHRw":{"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","attributes":{}}},"metadata":{"templates":{},"indices":{"kopf_test":{"state":"open","settings":{"index":{"uuid":"7yDVKjHeS7uKbQuQbs3VNw","analysis":{"analyzer":{"kopf_analyzer_1":{"type":"custom","tokenizer":"whitespace"},"kopf_analyzer_2":{"type":"custom","tokenizer":"whitespace"}}},"number_of_replicas":"1","number_of_shards":"5","version":{"created":"1000051"}}},"mappings":{"kopf":{"properties":{"id":{"type":"long"},"content_2":{"type":"string","fields":{"content_2_raw":{"type":"string"}}},"content_1":{"path":"just_name","type":"string","fields":{"content_1_raw":{"type":"string"}}}}}},"aliases":["kopf_alias_2","kopf_alias_1"]}}},"routing_table":{"indices":{"kopf_test":{"shards":{"2":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"}],"0":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"}],"3":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"}],"1":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"}],"4":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}]}}}},"routing_nodes":{"unassigned":[{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"UNASSIGNED","primary":false,"node":null,"relocating_node":null,"shard":4,"index":"kopf_test"}],"nodes":{"JvYCtd57Tn-fxlK1GVHRw":[{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"}]}},"allocations":[]}');
	var status2 = JSON.parse('{"_shards":{"total":10,"successful":5,"failed":0},"indices":{"kopf_test":{"index":{"primary_size_in_bytes":19887,"size_in_bytes":19887},"translog":{"operations":8},"docs":{"num_docs":7,"max_doc":7,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":13,"total_time_in_millis":125},"flush":{"total":0,"total_time_in_millis":0},"shards":{"0":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":0,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853127,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":15},"flush":{"total":0,"total_time_in_millis":0}}],"1":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":1,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853155,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}],"2":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":2,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":5563},"translog":{"id":1390857853170,"operations":2},"docs":{"num_docs":2,"max_doc":2,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":3,"total_time_in_millis":43},"flush":{"total":0,"total_time_in_millis":0}}],"3":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":3,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853142,"operations":3},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":4,"total_time_in_millis":35},"flush":{"total":0,"total_time_in_millis":0}}],"4":[{"routing":{"state":"STARTED","primary":true,"node":"JvYCtd57Tn-fxlK1GVHRw","relocating_node":null,"shard":4,"index":"kopf_test"},"state":"STARTED","index":{"size_in_bytes":2831},"translog":{"id":1390857853204,"operations":1},"docs":{"num_docs":1,"max_doc":1,"deleted_docs":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":2,"total_time_in_millis":16},"flush":{"total":0,"total_time_in_millis":0}}]}}}}');
	var stats2 = JSON.parse('{"cluster_name":"kopf_cluster","nodes":{"JvYCtd57Tn-fxlK1GVHRw":{"timestamp":1390858085598,"name":"Black Dragon","transport_address":"inet[/192.168.2.104:9300]","host":"leo.local","ip":["inet[/192.168.2.104:9300]","NONE"],"indices":{"docs":{"count":6,"deleted":0},"store":{"size_in_bytes":16887,"throttle_time_in_millis":0},"indexing":{"index_total":11,"index_time_in_millis":194,"index_current":0,"delete_total":2,"delete_time_in_millis":2,"delete_current":0},"get":{"total":0,"time_in_millis":0,"exists_total":0,"exists_time_in_millis":0,"missing_total":0,"missing_time_in_millis":0,"current":0},"search":{"open_contexts":0,"query_total":20,"query_time_in_millis":31,"query_current":0,"fetch_total":0,"fetch_time_in_millis":0,"fetch_current":0},"merges":{"current":0,"current_docs":0,"current_size_in_bytes":0,"total":0,"total_time_in_millis":0,"total_docs":0,"total_size_in_bytes":0},"refresh":{"total":65,"total_time_in_millis":295},"flush":{"total":2,"total_time_in_millis":16},"warmer":{"current":0,"total":12,"total_time_in_millis":4},"filter_cache":{"memory_size_in_bytes":0,"evictions":0},"id_cache":{"memory_size_in_bytes":0},"fielddata":{"memory_size_in_bytes":0,"evictions":0},"percolate":{"total":0,"time_in_millis":0,"current":0,"memory_size_in_bytes":0,"memory_size":"0b","queries":0},"completion":{"size_in_bytes":0},"segments":{"count":6,"memory_in_bytes":0},"translog":{"operations":8,"size_in_bytes":113}},"os":{"timestamp":1390858084866,"uptime_in_millis":693508,"load_average":[1.42822265625,1.63525390625,1.88037109375],"cpu":{"sys":11,"user":18,"idle":69,"usage":29,"stolen":0},"mem":{"free_in_bytes":495689728,"used_in_bytes":8094244864,"free_percent":41,"used_percent":58,"actual_free_in_bytes":3530981376,"actual_used_in_bytes":5058953216},"swap":{"used_in_bytes":0,"free_in_bytes":1073741824}},"process":{"timestamp":1390858084866,"open_file_descriptors":148,"cpu":{"percent":0,"sys_in_millis":63331,"user_in_millis":113294,"total_in_millis":176625},"mem":{"resident_in_bytes":324427776,"share_in_bytes":-1,"total_virtual_in_bytes":3883094016}},"jvm":{"timestamp":1390858084867,"uptime_in_millis":182268477,"mem":{"heap_used_in_bytes":102054072,"heap_used_percent":9,"heap_committed_in_bytes":251002880,"heap_max_in_bytes":1056309248,"non_heap_used_in_bytes":38337328,"non_heap_committed_in_bytes":38666240,"pools":{"young":{"used_in_bytes":83487440,"max_in_bytes":139591680,"peak_used_in_bytes":139591680,"peak_max_in_bytes":139591680},"survivor":{"used_in_bytes":2591784,"max_in_bytes":17432576,"peak_used_in_bytes":17432576,"peak_max_in_bytes":17432576},"old":{"used_in_bytes":15974848,"max_in_bytes":899284992,"peak_used_in_bytes":15974848,"peak_max_in_bytes":899284992}}},"threads":{"count":49,"peak_count":50},"gc":{"collectors":{"young":{"collection_count":9,"collection_time_in_millis":299},"old":{"collection_count":0,"collection_time_in_millis":0}}},"buffer_pools":{"direct":{"count":37,"used_in_bytes":9392421,"total_capacity_in_bytes":9392421},"mapped":{"count":0,"used_in_bytes":0,"total_capacity_in_bytes":0}}},"thread_pool":{"generic":{"threads":4,"queue":0,"active":0,"rejected":0,"largest":5,"completed":17733},"index":{"threads":2,"queue":0,"active":0,"rejected":0,"largest":2,"completed":13},"get":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"snapshot":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"merge":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13},"suggest":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"bulk":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"optimize":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"warmer":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":86},"flush":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":2},"search":{"threads":6,"queue":0,"active":0,"rejected":0,"largest":6,"completed":20},"percolate":{"threads":0,"queue":0,"active":0,"rejected":0,"largest":0,"completed":0},"management":{"threads":5,"queue":0,"active":2,"rejected":0,"largest":5,"completed":19932},"refresh":{"threads":1,"queue":0,"active":0,"rejected":0,"largest":1,"completed":13}},"network":{"tcp":{"active_opens":26842,"passive_opens":1470,"curr_estab":53,"in_segs":1812321,"out_segs":1561574,"retrans_segs":2190,"estab_resets":1395,"attempt_fails":4109,"in_errs":16,"out_rsts":-1}},"fs":{"timestamp":1390858084868,"total":{"total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816},"data":[{"path":"/Users/leo/Downloads/elasticsearch-1.0.0.RC1/data/kopf_cluster/nodes/0","mount":"/","dev":"/dev/disk0s2","total_in_bytes":255200755712,"free_in_bytes":82445713408,"available_in_bytes":82183569408,"disk_reads":578277,"disk_writes":854240,"disk_io_op":1432517,"disk_read_size_in_bytes":9500736512,"disk_write_size_in_bytes":15133154304,"disk_io_size_in_bytes":24633890816}]},"transport":{"server_open":13,"rx_count":27,"rx_size_in_bytes":2753,"tx_count":27,"tx_size_in_bytes":3409},"http":{"current_open":6,"total_opened":139},"fielddata_breaker":{"maximum_size_in_bytes":845047398,"maximum_size":"805.8mb","estimated_size_in_bytes":0,"estimated_size":"0b","overhead":1.03}}}}');
	var settings2 = JSON.parse('{"persistent":{},"transient":{"cluster":{"routing":{"allocation":{"disable_allocation":"false"}}}}}');
	var cluster2 = new Cluster(state2, status2, stats2, settings2);

	cluster2.computeChanges(cluster);
	
	ok(cluster2.changes.getDocDelta() == 1, "Checking document delta");
	ok(cluster2.changes.getDataDelta() == 3000, "" + cluster2.changes.getDataDelta());
	ok(cluster2.changes.absDataDelta() == "2.93KB", "" + cluster2.changes.absDataDelta());

	ok(cluster2.changes.nodeJoins.length == 1, "checking joinng nodes");
	ok(cluster2.changes.nodeLeaves.length == 1, "checking disconnecting nodes");
	
	ok(cluster2.changes.nodeJoins[0].id == "JvYCtd57Tn-fxlK1GVHRw", "checking node identity");
	ok(cluster2.changes.nodeLeaves[0].id == "JvYCtd57Tne-fxlK1GVHRw", "checking node identity");
	

});
